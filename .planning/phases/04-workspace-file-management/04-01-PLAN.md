---
phase: 04-workspace-file-management
plan: 01
type: execute
wave: 1
depends_on: []
files_modified: [src/web_ui.py, src/agent/prompts.py, src/agent/tools/workspace.py]
autonomous: true
requirements: [ENG-03, WEB-03]

must_haves:
  truths:
    - "User can upload a file through the Chainlit interface."
    - "Uploaded files appear in the ./workspace directory on the host."
    - "Agent is notified of the file upload and its location."
  artifacts:
    - path: "src/agent/tools/workspace.py"
      provides: "Tools for the agent to list and manage workspace files."
    - path: "src/web_ui.py"
      provides: "cl.on_chat_start and cl.on_file_upload handlers for file management."
  key_links:
    - from: "src/web_ui.py"
      to: "./workspace"
      via: "saving uploaded files"
    - from: "src/agent/prompts.py"
      to: "/workspace"
      via: "system prompt context"
---

<objective>
Implement file upload capabilities and allow the agent to interact with files in the workspace.

Purpose: Allow users to share data with the agent for processing.
Output: Working file upload in UI and agent awareness of workspace files.
</objective>

<execution_context>
@/home/brassy/.gemini/get-shit-done/workflows/execute-plan.md
@/home/brassy/.gemini/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@src/web_ui.py
@src/agent/core.py
@src/agent/prompts.py
@src/sandbox/manager.py
</context>

<tasks>

<task type="auto">
  <name>Task 1: Implement Workspace Tools</name>
  <files>src/agent/tools/workspace.py, src/agent/core.py</files>
  <action>
    - Create `src/agent/tools/workspace.py` with a `list_workspace_files()` function that returns a list of files in the `./workspace` directory.
    - Integrate `list_workspace_files` as a tool in `ironclaw_agent` (src/agent/core.py).
    - Ensure the tool handles potential issues (e.g., directory doesn't exist yet).
  </action>
  <verify>
    <automated>python3 -c "from src.agent.tools.workspace import list_workspace_files; print(list_workspace_files())"</automated>
    <manual>Verify the tool is registered in the agent's core.py.</manual>
    <sampling_rate>run after this task commits, before next task begins</sampling_rate>
  </verify>
  <done>Agent can programmatically list files in the workspace.</done>
</task>

<task type="auto">
  <name>Task 2: Implement File Upload in Web UI</name>
  <files>src/web_ui.py, src/agent/prompts.py</files>
  <action>
    - Add `cl.on_chat_start` logic to ensure `./workspace` exists.
    - Implement `cl.on_file_upload` in `src/web_ui.py`:
      - Save uploaded files to the `./workspace` directory.
      - Send a message to the agent (via the chat history) indicating that a new file was uploaded to `/workspace/[filename]`.
    - Update `IRONCLAW_SYSTEM_PROMPT` in `src/agent/prompts.py` to mention that `/workspace` is the primary file exchange directory.
  </action>
  <verify>
    <automated>python3 -c "import os; from src.web_ui import on_file_upload; print('File upload handler exists')"</automated>
    <manual>Run the web UI and attempt to upload a file. Verify it appears in the `./workspace` directory and the agent acknowledges it.</manual>
    <sampling_rate>run after this task commits, before next task begins</sampling_rate>
  </verify>
  <done>User can upload files via the UI and the agent is aware of them.</done>
</task>

</tasks>

<verification>
- Upload a sample .txt file through the UI.
- Verify it is saved to the local `./workspace/` directory.
- Ask the agent: "What files are in the workspace?" and ensure it lists the uploaded file correctly.
- Ask the agent: "Read the content of the file I just uploaded" and ensure it can access and report the contents.
</verification>

<success_criteria>
- File upload is functional in Chainlit.
- Uploaded files are persisted in `./workspace`.
- Agent can list and interact with workspace files using its tools.
</success_criteria>

<output>
After completion, create `.planning/phases/04-workspace-file-management/04-01-SUMMARY.md`
</output>
